
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Facility Search: List & Map View</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 1000px; margin: auto; }
    input, select { padding: 10px; font-size: 1rem; margin: 5px 10px 15px 0; }
    .filters { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
    .view-toggle { margin-bottom: 20px; }
    .view-toggle button {
      padding: 8px 16px;
      font-size: 1rem;
      margin-right: 10px;
      cursor: pointer;
    }
    ul { list-style: none; padding: 0; display: none; }
    ul.visible { display: block; }
    li { margin-bottom: 15px; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
    .features { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .feature { padding: 5px 10px; border-radius: 5px; font-size: 0.9rem; }
    .supported { background-color: #e0f7e9; color: #2e7d32; border: 1px solid #81c784; }
    .unsupported { background-color: #fdecea; color: #c62828; border: 1px solid #ef9a9a; }
    #map { height: 600px; width: 100%; display: none; margin-top: 20px; }
  </style>
</head>
<body>

<h2>Facility Search & Toggle View</h2>

<div class="view-toggle">
  <button onclick="setView('list')">üîç List View</button>
  <button onclick="setView('map')">üó∫Ô∏è Map View</button>
</div>

<input type="text" id="searchInput" placeholder="Search by country, postcode, or name..." />

<div class="filters">
  <div><label>Fast T1 Cardiac</label><br><select id="fastT1CardiacFilter">
    <option value="all">All</option><option value="true">Supported</option><option value="false">Not Supported</option>
  </select></div>
  <div><label>LMS</label><br><select id="lmsFilter">
    <option value="all">All</option><option value="true">Supported</option><option value="false">Not Supported</option>
  </select></div>
  <div><label>MRCP+</label><br><select id="mrcpPlusFilter">
    <option value="all">All</option><option value="true">Supported</option><option value="false">Not Supported</option>
  </select></div>
  <div><label>Hepatica</label><br><select id="hepaticaFilter">
    <option value="all">All</option><option value="true">Supported</option><option value="false">Not Supported</option>
  </select></div>
  <div><label>Coverscan</label><br><select id="coverscanFilter">
    <option value="all">All</option><option value="true">Supported</option><option value="false">Not Supported</option>
  </select></div>
  <div><label>VitruvianScan</label><br><select id="vitruvianScanFilter">
    <option value="all">All</option><option value="true">Supported</option><option value="false">Not Supported</option>
  </select></div>
</div>

<ul id="results"></ul>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const facilities = [
  {
    "name": "University of California Davis Health",
    "address": "UC Davis Health Lawrence J Ellison Ambulatory Care Center, Y Street, Sacramento, CA, USA",
    "fastT1Cardiac": true,
    "lms": true,
    "mrcpPlus": true,
    "hepatica": false,
    "coverscan": false,
    "vitruvianScan": false,
    "latitude": 38.5521,
    "longitude": -121.4513
  },
  {
    "name": "Alliance Medical - St Peters Hospital",
    "address": "St Peter's Hospital, Guildford Road, Lyne, Chertsey, UK",
    "fastT1Cardiac": false,
    "lms": false,
    "mrcpPlus": true,
    "hepatica": false,
    "coverscan": false,
    "vitruvianScan": false,
    "latitude": 51.3745,
    "longitude": -0.5155
  },
  {
    "name": "Northwest Radiology",
    "address": "10603 N Meridian St, Carmel, Indiana, USA",
    "fastT1Cardiac": true,
    "lms": true,
    "mrcpPlus": false,
    "hepatica": true,
    "coverscan": false,
    "vitruvianScan": false,
    "latitude": 39.9402,
    "longitude": -86.1472
  },
  {
    "name": "Ospedale S. Andrea",
    "address": "Via di Grottarossa, 1035, Rome, Metropolitan City of Rome Capital, Italy",
    "fastT1Cardiac": true,
    "lms": true,
    "mrcpPlus": true,
    "hepatica": true,
    "coverscan": true,
    "vitruvianScan": false,
    "latitude": 41.9934,
    "longitude": 12.4578
  },
  {
    "name": "Shin Imaging",
    "address": "Shin Imaging - Fullerton, Sunny Crest Drive, Fullerton, CA, USA",
    "fastT1Cardiac": true,
    "lms": true,
    "mrcpPlus": true,
    "hepatica": true,
    "coverscan": false,
    "vitruvianScan": true,
    "latitude": 33.8819,
    "longitude": -117.9291
  },
  {
    "name": "Voxel - Krakow",
    "address": "Wielicka 265, 30-663 Krak\u00f3w, Poland",
    "fastT1Cardiac": true,
    "lms": true,
    "mrcpPlus": false,
    "hepatica": false,
    "coverscan": false,
    "vitruvianScan": false,
    "latitude": 50.0153,
    "longitude": 19.9735
  },
  {
    "name": "CERCO Investigacion",
    "address": "Ronda de Capuchinos, 11, 41003 Seville, Spain",
    "fastT1Cardiac": true,
    "lms": true,
    "mrcpPlus": false,
    "hepatica": false,
    "coverscan": false,
    "vitruvianScan": false,
    "latitude": 37.3925,
    "longitude": -5.9846
  },
  {
    "name": "SimonMed - Streeterville",
    "address": "446 East Ontario Street suite 106, Chicago, IL, USA",
    "fastT1Cardiac": true,
    "lms": true,
    "mrcpPlus": true,
    "hepatica": false,
    "coverscan": false,
    "vitruvianScan": false,
    "latitude": 41.8925,
    "longitude": -87.613
  },
  {
    "name": "Tulane Hospital",
    "address": "1415 Tulane Ave, New Orleans, LA 70112, USA",
    "fastT1Cardiac": true,
    "lms": true,
    "mrcpPlus": true,
    "hepatica": false,
    "coverscan": false,
    "vitruvianScan": false,
    "latitude": 29.9574,
    "longitude": -90.0774
  },
  {
    "name": "Clinica Ascires CETIR",
    "address": "Carrer de Viladomat, 299, Barcelona, Spain",
    "fastT1Cardiac": true,
    "lms": true,
    "mrcpPlus": true,
    "hepatica": true,
    "coverscan": true,
    "vitruvianScan": false,
    "latitude": 41.387,
    "longitude": 2.1504
  }
];
  let markers = [];
  const resultsList = document.getElementById("results");
  const map = L.map('map').setView([40, 0], 2);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  function setView(view) {
    document.getElementById("results").style.display = view === "list" ? "block" : "none";
    document.getElementById("map").style.display = view === "map" ? "block" : "none";
    if (view === "map") map.invalidateSize();
  }

  function getPopupContent(f) {
    return `
      <strong>${f.name}</strong><br>
      <em>${f.address}</em>
      <div class="features">
        <span class="feature ${f.fastT1Cardiac ? 'supported' : 'unsupported'}">Fast T1 Cardiac</span>
        <span class="feature ${f.lms ? 'supported' : 'unsupported'}">LMS</span>
        <span class="feature ${f.mrcpPlus ? 'supported' : 'unsupported'}">MRCP+</span>
        <span class="feature ${f.hepatica ? 'supported' : 'unsupported'}">Hepatica</span>
        <span class="feature ${f.coverscan ? 'supported' : 'unsupported'}">Coverscan</span>
        <span class="feature ${f.vitruvianScan ? 'supported' : 'unsupported'}">VitruvianScan</span>
      </div>
    `;
  }

  function renderResults(list) {
    resultsList.innerHTML = "";
    list.forEach(f => {
      const li = document.createElement("li");
      li.innerHTML = `
        <strong>${f.name}</strong><br>
        <em>${f.address}</em>
        <div class="features">
          <span class="feature ${f.fastT1Cardiac ? 'supported' : 'unsupported'}">Fast T1 Cardiac</span>
          <span class="feature ${f.lms ? 'supported' : 'unsupported'}">LMS</span>
          <span class="feature ${f.mrcpPlus ? 'supported' : 'unsupported'}">MRCP+</span>
          <span class="feature ${f.hepatica ? 'supported' : 'unsupported'}">Hepatica</span>
          <span class="feature ${f.coverscan ? 'supported' : 'unsupported'}">Coverscan</span>
          <span class="feature ${f.vitruvianScan ? 'supported' : 'unsupported'}">VitruvianScan</span>
        </div>
      `;
      resultsList.appendChild(li);
    });
    resultsList.classList.toggle("visible", list.length > 0);
  }

  function renderMapMarkers(list) {
    markers.forEach(marker => map.removeLayer(marker));
    markers = [];

    list.forEach(f => {
      const marker = L.marker([f.latitude, f.longitude]).addTo(map);
      marker.bindPopup(getPopupContent(f));
      markers.push(marker);
    });
  }

  function applyFilters() {
    const query = document.getElementById("searchInput").value.toLowerCase();
    const filters = {
      fastT1Cardiac: document.getElementById("fastT1CardiacFilter").value,
      lms: document.getElementById("lmsFilter").value,
      mrcpPlus: document.getElementById("mrcpPlusFilter").value,
      hepatica: document.getElementById("hepaticaFilter").value,
      coverscan: document.getElementById("coverscanFilter").value,
      vitruvianScan: document.getElementById("vitruvianScanFilter").value
    };

    const filtered = facilities.filter(f => {
      const regex = new RegExp(`\\b${query}\\b`, 'i');
      const matchesQuery = regex.test(f.address) || regex.test(f.name);
      const matchesFilters = Object.entries(filters).every(([key, val]) => {
        if (val === "all") return true;
        return f[key] === (val === "true");
      });
      return matchesQuery && matchesFilters;
    });

    renderResults(filtered);
    renderMapMarkers(filtered);

    if (filtered.length > 0) {
      const first = filtered[0];
      map.setView([first.latitude, first.longitude], 6);
    }
  }

  document.getElementById("searchInput").addEventListener("input", applyFilters);
  document.querySelectorAll("select").forEach(el => el.addEventListener("change", applyFilters));

  //applyFilters();
  setView("list");
</script>

</body>
</html>
